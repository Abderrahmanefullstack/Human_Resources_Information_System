{% extends 'annonces/base_annonces.html' %}
{% block title %}Annonces RH â€” Liste{% endblock %}
{% load form_extras %}
{% block content %}

<style>
  /* â€”â€”â€” Styles portables et scoping â€”â€”â€” */
  .annonces-toolbar .btn-pill{ border-radius: 9999px; }
  .annonces-toolbar .badge-soft{ background:#f8f9fa; color:#6c757d; border:1px solid #e9ecef; }

  .annonce-card{
    position:relative; border:1px solid #eee; border-radius:16px; overflow:hidden;
    box-shadow:0 6px 22px rgba(0,0,0,.06); transition:transform .15s ease, box-shadow .15s ease;
  }
  .annonce-card:hover{ transform: translateY(-2px); box-shadow:0 12px 32px rgba(0,0,0,.09); }

  /* Rail de statut (gauche) */
  .annonce-card::before{
    content:""; position:absolute; left:0; top:0; bottom:0; width:6px; background:#e2e3e5;
  }
  .annonce--active::before{ background:#2ecc71; }   /* vert */
  .annonce--hidden::before{ background:#adb5bd; }   /* gris */

  /* En-tÃªte carte */
  .annonce-title{ font-weight:700; line-height:1.2; }
  .badge-status{
    font-size:.78rem; border-radius:999px; padding:.25rem .6rem;
  }
  .badge-status.active{ background:#d1e7dd; color:#0f5132; }
  .badge-status.hidden{ background:#e2e3e5; color:#41464b; }

  /* Chips de pÃ©riode */
  .chip{
    display:inline-flex; align-items:center; gap:.35rem;
    padding:.28rem .6rem; border-radius:999px; background:#f8f9fa;
    border:1px solid #eee; color:#495057; font-size:.83rem;
  }

  /* Contenu : clamp 3 lignes */
  .clamp-3{
    display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden;
  }

  .meta{ color:#6c757d; font-size:.85rem; }
</style>

<!-- Toolbar -->
<div class="annonces-toolbar d-flex flex-wrap align-items-center justify-content-between mb-3 gap-2">
  <span class="badge badge-soft rounded-pill px-3 py-2">
    <i class="fa-solid fa-list me-2"></i>{{ annonces|length }} annonce{{ annonces|length|pluralize:"s" }}
  </span>
  <a class="btn btn-primary btn-pill" href="{% url 'annonces:create' %}">
    <i class="fa fa-plus me-2"></i>Nouvelle annonce
  </a>
</div>

<!-- Grid des annonces -->
<div class="row g-3">
  {% for a in annonces %}
  <div class="col-12 col-md-6 col-lg-4">
    <article class="annonce-card h-100 {% if a.actif %}annonce--active{% else %}annonce--hidden{% endif %}">
      <div class="p-3 d-flex flex-column h-100">

        <!-- Titre + statut -->
        <div class="d-flex align-items-start justify-content-between mb-2">
          <h5 class="annonce-title mb-0">{{ a.titre }}</h5>
          {% if a.actif %}
            <span class="badge-status active">Active</span>
          {% else %}
            <span class="badge-status hidden">MasquÃ©e</span>
          {% endif %}
        </div>

        <!-- PÃ©riode (chips) -->
        <div class="mb-2">
          {% if a.date_debut %}
            <span class="chip"><i class="fa-regular fa-calendar"></i>Du {{ a.date_debut|date:"d/m/Y" }}</span>
          {% endif %}
          {% if a.date_fin %}
            <span class="chip"><i class="fa-regular fa-calendar-check"></i>Au {{ a.date_fin|date:"d/m/Y" }}</span>
          {% endif %}
          {% if not a.date_debut and not a.date_fin %}
            <span class="chip"><i class="fa-regular fa-circle"></i>Sans pÃ©riode</span>
          {% endif %}
        </div>

        <!-- AperÃ§u contenu -->
        <div class="clamp-3 flex-grow-1">{{ a.contenu|linebreaksbr }}</div>

        <!-- Footer actions -->
        <div class="d-flex justify-content-between align-items-center mt-3">
          <small class="meta">
            CrÃ©Ã©e le {{ a.created_at|date:"d/m/Y H:i" }}
          </small>
          <div class="d-flex gap-2">
            <a href="{% url 'annonces:update' a.pk %}" class="btn btn-sm btn-outline-primary">
              <i class="fa fa-pen me-1"></i>Modifier
            </a>
            <a href="{% url 'annonces:delete' a.pk %}" class="btn btn-sm btn-outline-danger">
              <i class="fa fa-trash me-1"></i>Supprimer
            </a>
          </div>
        </div>

      </div>
    </article>
  </div>
  {% empty %}
  <div class="col-12">
    <div class="annonce-card p-5 text-center">
      <div class="display-6 mb-2">ðŸ¥²</div>
      <p class="mb-3">Aucune annonce pour le moment.</p>
      <a href="{% url 'annonces:create' %}" class="btn btn-primary btn-pill">
        <i class="fa fa-plus me-2"></i>CrÃ©er la premiÃ¨re annonce
      </a>
    </div>
  </div>
  {% endfor %}
</div>

{% endblock %}
